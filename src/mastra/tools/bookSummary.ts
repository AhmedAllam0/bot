import { createTool } from "@mastra/core/tools";
import { z } from "zod";

export const getBookSummaryTool = createTool({
  id: "get_book_summary",
  description: "ุงูุญุตูู ุนูู ููุฎุต ูุชุงุจ ูุนูู. ุงุณุชุฎุฏู ูุฐู ุงูุฃุฏุงุฉ ุนูุฏูุง ูุทูุจ ุงููุณุชุฎุฏู ููุฎุตุงู ููุชุงุจ.",
  inputSchema: z.object({
    bookName: z.string().describe("ุงุณู ุงููุชุงุจ"),
    authorName: z.string().optional().describe("ุงุณู ุงููุคูู (ุงุฎุชูุงุฑู)"),
  }),
  outputSchema: z.object({
    found: z.boolean(),
    book: z.object({
      title: z.string(),
      author: z.string(),
      summary: z.string(),
      mainThemes: z.array(z.string()),
      targetAudience: z.string(),
      pageCount: z.string(),
      publicationYear: z.string(),
    }).optional(),
    searchQuery: z.string(),
  }),
  execute: async ({ context, mastra }) => {
    const logger = mastra?.getLogger();
    const { bookName, authorName } = context;
    
    logger?.info("๐ [getBookSummary] ุงูุจุญุซ ุนู ููุฎุต ุงููุชุงุจ:", { bookName, authorName });
    
    const searchQuery = authorName 
      ? `ููุฎุต ูุชุงุจ ${bookName} ${authorName}`
      : `ููุฎุต ูุชุงุจ ${bookName}`;
    
    const knownBooks: Record<string, any> = {
      "ุงูุซูุงุซูุฉ": {
        title: "ุซูุงุซูุฉ ุงููุงูุฑุฉ (ุจูู ุงููุตุฑูู - ูุตุฑ ุงูุดูู - ุงูุณูุฑูุฉ)",
        author: "ูุฌูุจ ูุญููุธ",
        summary: "ููุญูุฉ ุฑูุงุฆูุฉ ุชุชุจุน ุญูุงุฉ ุนุงุฆูุฉ ุงูุณูุฏ ุฃุญูุฏ ุนุจุฏ ุงูุฌูุงุฏ ุนุจุฑ ุซูุงุซุฉ ุฃุฌูุงู ูู ูุตุฑุ ูู ุฃูุงุฎุฑ ุงูุญูู ุงูุนุซูุงูู ุญุชู ุซูุฑุฉ 1952. ุชุตูุฑ ุงูุฑูุงูุฉ ุงูุชุญููุงุช ุงูุงุฌุชูุงุนูุฉ ูุงูุณูุงุณูุฉ ูู ุงููุฌุชูุน ุงููุตุฑู ูู ุฎูุงู ุตุฑุงุนุงุช ุงูุนุงุฆูุฉ ุงูุฏุงุฎููุฉ ูุงูุชุบูุฑุงุช ูู ุงูููู ูุงูุชูุงููุฏ.",
        mainThemes: ["ุงูุตุฑุงุน ุจูู ุงูุฃุฌูุงู", "ุงูุชุญููุงุช ุงูุงุฌุชูุงุนูุฉ", "ุงููููุฉ ุงููุตุฑูุฉ", "ุงูุญุจ ูุงูุฒูุงุฌ"],
        targetAudience: "ูุญุจู ุงูุฃุฏุจ ุงูููุงุณููู ูุงูุฑูุงูุงุช ุงูุนุงุฆููุฉ",
        pageCount: "ุญูุงูู 1500 ุตูุญุฉ (ุงูุซูุงุซูุฉ ูุงููุฉ)",
        publicationYear: "1956-1957",
      },
      "1984": {
        title: "1984",
        author: "ุฌูุฑุฌ ุฃูุฑููู",
        summary: "ุฑูุงูุฉ ุฏูุณุชูุจูุฉ ุชุฏูุฑ ูู ุนุงูู ูุณุชูุจูู ุชุญููู ุฏููุฉ ุดููููุฉ ุจููุงุฏุฉ 'ุงูุฃุฎ ุงูุฃูุจุฑ'. ุชุชุจุน ูุตุฉ ููุณุชูู ุณููุซ ุงูุฐู ูุนูู ูู ูุฒุงุฑุฉ ุงูุญูููุฉ ููุจุฏุฃ ุจุงูุชุดููู ูู ุงููุธุงู. ุชุญุฐุฑ ุงูุฑูุงูุฉ ูู ูุฎุงุทุฑ ุงูุงุณุชุจุฏุงุฏ ููุฑุงูุจุฉ ุงูุฏููุฉ ูุงูุชูุงุนุจ ุจุงูุญูููุฉ.",
        mainThemes: ["ุงูุดููููุฉ", "ุงููุฑุงูุจุฉ", "ุงูุญุฑูุฉ ุงููุฑุฏูุฉ", "ุงูุชูุงุนุจ ุจุงูุญูููุฉ"],
        targetAudience: "ูุญุจู ุงูุฃุฏุจ ุงูุณูุงุณู ูุงูุฏูุณุชูุจูุง",
        pageCount: "ุญูุงูู 328 ุตูุญุฉ",
        publicationYear: "1949",
      },
      "ุงูุฃุณูุฏ ูููู ุจู": {
        title: "ุงูุฃุณูุฏ ูููู ุจู",
        author: "ุฃุญูุงู ูุณุชุบุงููู",
        summary: "ุฑูุงูุฉ ุฑููุงูุณูุฉ ูุนุงุตุฑุฉ ุชุฏูุฑ ุญูู ูุตุฉ ุญุจ ูุนูุฏุฉ ุจูู ุงูุฑุฃุฉ ูุฑุฌู ูุฎุชุจุฆ ูุฑุงุก ุงููุชุงุจุฉ. ุชูุฒุฌ ุจูู ุงูุญุจ ูุงูููุฏ ูุงูุจุญุซ ุนู ุงูุฐุงุช ูู ุฅุทุงุฑ ุดุงุนุฑู ูููุฒ.",
        mainThemes: ["ุงูุญุจ ุงููุณุชุญูู", "ุงููููุฉ", "ุงููุชุงุจุฉ ูุงูุฅุจุฏุงุน", "ุงูููุฏ"],
        targetAudience: "ูุญุจู ุงูุฑูุงูุงุช ุงูุฑููุงูุณูุฉ ูุงูุฃุฏุจ ุงูุนุฑุจู ุงููุนุงุตุฑ",
        pageCount: "ุญูุงูู 300 ุตูุญุฉ",
        publicationYear: "2012",
      },
      "ุฐุงูุฑุฉ ุงูุฌุณุฏ": {
        title: "ุฐุงูุฑุฉ ุงูุฌุณุฏ",
        author: "ุฃุญูุงู ูุณุชุบุงููู",
        summary: "ุฑูุงูุฉ ุชุญูู ูุตุฉ ุฑุณุงู ุฌุฒุงุฆุฑู ููุฏ ุฐุฑุงุนู ูู ุญุฑุจ ุงูุชุญุฑูุฑุ ููุน ูู ุญุจ ุงุจูุฉ ุดููุฏ ูุงู ุตุฏููู. ุชูุฒุฌ ุจูู ุงูุญุจ ูุงููุทู ูุงูุฐุงูุฑุฉ ูู ุณุฑุฏ ุดุงุนุฑู ูุคุซุฑ.",
        mainThemes: ["ุงูุญุจ ูุงููุทู", "ุงูุฐุงูุฑุฉ ูุงููููุฉ", "ุงูุชุถุญูุฉ", "ุงููู ูุงูุฅุจุฏุงุน"],
        targetAudience: "ูุญุจู ุงูุฃุฏุจ ุงูุนุฑุจู ุงูุฑููุงูุณู",
        pageCount: "ุญูุงูู 350 ุตูุญุฉ",
        publicationYear: "1993",
      },
      "ุงููุจู": {
        title: "ุงููุจู",
        author: "ุฌุจุฑุงู ุฎููู ุฌุจุฑุงู",
        summary: "ูุฌููุนุฉ ูู ุงูููุงูุงุช ุงูุดุนุฑูุฉ ุงูููุณููุฉ ุนูู ูุณุงู ูุจู ูุฏุนู ุงููุตุทููุ ูุชุญุฏุซ ุนู ููุงุถูุน ุงูุญูุงุฉ ุงูุฃุณุงุณูุฉ ูุงูุญุจ ูุงูุฒูุงุฌ ูุงูุฃุทูุงู ูุงูุนูู ูุงูููุช ูุจู ุฑุญููู ุนู ูุฏููุฉ ุฃูุฑูููุณ.",
        mainThemes: ["ุงูุญุจ", "ุงูุญุฑูุฉ", "ุงูููุช ูุงูุญูุงุฉ", "ุงูุญููุฉ"],
        targetAudience: "ูุญุจู ุงูุฃุฏุจ ุงูููุณูู ูุงูุดุนุฑ",
        pageCount: "ุญูุงูู 107 ุตูุญุงุช",
        publicationYear: "1923",
      },
    };
    
    const normalizedName = bookName.trim().toLowerCase();
    let foundBook = null;
    
    for (const [key, value] of Object.entries(knownBooks)) {
      if (normalizedName.includes(key.toLowerCase()) || key.toLowerCase().includes(normalizedName)) {
        foundBook = value;
        break;
      }
    }
    
    if (foundBook) {
      logger?.info("โ [getBookSummary] ุชู ุงูุนุซูุฑ ุนูู ููุฎุต ุงููุชุงุจ:", { title: foundBook.title });
      return {
        found: true,
        book: foundBook,
        searchQuery,
      };
    }
    
    logger?.info("โ [getBookSummary] ูู ูุชู ุงูุนุซูุฑ ุนูู ููุฎุต ุงููุชุงุจ:", { bookName });
    return {
      found: false,
      searchQuery,
    };
  },
});
